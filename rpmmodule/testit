#!/usr/bin/python

import rpm
import os
import time

def cb(what, amount, total, key, data):
    if (what == rpm.RPMCALLBACK_INST_OPEN_FILE):
	d = os.open(key, os.O_RDONLY)
	return d

## fd = os.open('foo', os.O_RDONLY);
## (h, isSource) = rpm.headerFromPackage(fd)
## print "from foo:", h[rpm.RPMTAG_NAME]
## os.close(fd)

list = rpm.readHeaderList('/mnt/test/msw/i386/RedHat/base/hdlist')
print "got", len(list), "items"

print "finding upgrade set..."
ugset = rpm.findUpgradeSet (list)
for header in ugset:
    print header[rpm.RPMTAG_NAME]

#d = rpm.opendb(0)

#ts = rpm.TransactionSet()

#for h in list:
#    ts.add(h, "foo", "a")

#ts.add(list[0], "foo")
#rc = ts.depcheck()
#print rc

#ts.order()
#print "run", ts.run(rpm.RPMTRANS_FLAG_TEST, 0, cb, "arg")

